<div class="flex min-h-screen bg-gray-50">
  <app-dehasbort/>

  <div class="flex-1 p-8 mt-20 ml-6">
    <!-- En-tête du formulaire -->
    <div class="mb-8">
      <div class="flex items-center text-2xl font-semibold text-teal-800 mb-2">
        <i class="fas fa-user-circle w-8 h-8 text-teal-800 mr-2"></i>
        <h1>Ajouter un expert</h1>
      </div>
      <p class="text-gray-600 text-sm">Remplissez les informations nécessaires pour ajouter un nouvel expert au système.</p>
    </div>

    <!-- Formulaire -->
    <form [formGroup]="expertForm" (ngSubmit)="onSubmit()" class="bg-white shadow-md rounded-lg p-6">
      <!-- Sections avec séparateurs -->
      <div class="mb-6">
        <h2 class="text-lg font-medium text-teal-800 mb-4 pb-2 border-b border-gray-200">Informations personnelles</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Nom -->
          <div>
            <label for="nom" class="block mb-2 text-sm font-medium text-gray-700">Nom <span class="text-red-500">*</span></label>
            <input
              id="nom"
              type="text"
              formControlName="nom"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              placeholder="Entrez le nom"
            >
            <div *ngIf="expertForm.get('nom')?.invalid && expertForm.get('nom')?.touched" class="text-red-500 text-xs mt-1">
              Le nom est requis.
            </div>
          </div>

          <!-- Prénom -->
          <div>
            <label for="prenom" class="block mb-2 text-sm font-medium text-gray-700">Prénom <span class="text-red-500">*</span></label>
            <input
              id="prenom"
              type="text"
              formControlName="prenom"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              placeholder="Entrez le prénom"
            >
            <div *ngIf="expertForm.get('prenom')?.invalid && expertForm.get('prenom')?.touched" class="text-red-500 text-xs mt-1">
              Le prénom est requis.
            </div>
          </div>

          <!-- CIN -->
          <div>
            <label for="cin" class="block mb-2 text-sm font-medium text-gray-700">CIN <span class="text-red-500">*</span></label>
            <input
              id="cin"
              type="text"
              formControlName="cin"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              [class.border-red-500]="cinExists || (expertForm.get('cin')?.invalid && expertForm.get('cin')?.touched)"
              placeholder="Entrez le CIN"
            >
            <div *ngIf="cinChecking" class="text-blue-500 text-xs mt-1">Vérification du CIN en cours...</div>
            <div *ngIf="expertForm.get('cin')?.hasError('required') && expertForm.get('cin')?.touched" class="text-red-500 text-xs mt-1">
              Le CIN est requis.
            </div>
            <div *ngIf="expertForm.get('cin')?.hasError('pattern') && expertForm.get('cin')?.touched" class="text-red-500 text-xs mt-1">
              Le CIN doit comporter exactement 8 chiffres.
            </div>
            <div *ngIf="cinExists" class="text-red-500 text-xs mt-1">
              Ce CIN est déjà utilisé.
            </div>
          </div>

          <!-- Date de naissance -->
          <div>
            <label for="dateNaissance" class="block mb-2 text-sm font-medium text-gray-700">Date de naissance <span class="text-red-500">*</span></label>
            <input
              id="dateNaissance"
              type="date"
              formControlName="dateNaissance"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
            >
            <div *ngIf="expertForm.get('dateNaissance')?.invalid && expertForm.get('dateNaissance')?.touched" class="text-red-500 text-xs mt-1">
              <div *ngIf="expertForm.get('dateNaissance')?.errors?.['required']">
                La date de naissance est requise.
              </div>
              <div *ngIf="expertForm.get('dateNaissance')?.errors?.['invalidDateNaissance']">
                La date de naissance doit être entre 1970 et 2000.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Coordonnées -->
      <div class="mb-6">
        <h2 class="text-lg font-medium text-teal-800 mb-4 pb-2 border-b border-gray-200">Coordonnées</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Téléphone -->
          <div>
            <label for="telephone" class="block mb-2 text-sm font-medium text-gray-700">Téléphone <span class="text-red-500">*</span></label>
            <input
              id="telephone"
              type="tel"
              formControlName="telephone"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              placeholder="Entrez le téléphone"
            >
            <div *ngIf="expertForm.get('telephone')?.invalid && expertForm.get('telephone')?.touched" class="text-red-500 text-xs mt-1">
              Le téléphone est requis.
            </div>
          </div>

          <!-- Email -->
          <div>
            <label for="email" class="block mb-2 text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
            <input
              id="email"
              type="email"
              formControlName="email"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              [class.border-red-500]="emailExists || (expertForm.get('email')?.invalid && expertForm.get('email')?.touched)"
              placeholder="Entrez l'email"
            >
            <div *ngIf="emailChecking" class="text-blue-500 text-xs mt-1">Vérification de l'email en cours...</div>
            <div *ngIf="expertForm.get('email')?.hasError('required') && expertForm.get('email')?.touched" class="text-red-500 text-xs mt-1">
              L'email est requis.
            </div>
            <div *ngIf="expertForm.get('email')?.hasError('email') && expertForm.get('email')?.touched" class="text-red-500 text-xs mt-1">
              Veuillez entrer un email valide.
            </div>
            <div *ngIf="emailExists" class="text-red-500 text-xs mt-1">
              Cet email est déjà utilisé.
            </div>
          </div>
        </div>
      </div>

      <!-- Adresse -->
      <div class="mb-6">
        <h2 class="text-lg font-medium text-teal-800 mb-4 pb-2 border-b border-gray-200">Adresse</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Rue -->
          <div>
            <label for="rue" class="block mb-2 text-sm font-medium text-gray-700">Rue <span class="text-red-500">*</span></label>
            <input
              id="rue"
              type="text"
              formControlName="rue"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              placeholder="Entrez la rue"
            >
            <div *ngIf="expertForm.get('rue')?.invalid && expertForm.get('rue')?.touched" class="text-red-500 text-xs mt-1">
              La rue est requise.
            </div>
          </div>

          <!-- Gouvernorat -->
          <div>
            <label for="gouvernat" class="block mb-2 text-sm font-medium text-gray-700">Gouvernorat <span class="text-red-500">*</span></label>
            <select
              id="gouvernat"
              formControlName="gouvernat"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
            >
              <option value="" disabled selected>Sélectionnez un gouvernorat</option>
              <option *ngFor="let g of gouvernorats" [value]="g">{{ g }}</option>
            </select>
            <div *ngIf="expertForm.get('gouvernat')?.invalid && expertForm.get('gouvernat')?.touched" class="text-red-500 text-xs mt-1">
              Le gouvernorat est requis.
            </div>
          </div>

          <!-- Ville -->
          <div>
            <label for="ville" class="block mb-2 text-sm font-medium text-gray-700">Ville <span class="text-red-500">*</span></label>
            <select
              id="ville"
              formControlName="ville"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              [disabled]="!expertForm.get('gouvernat')?.value"
            >
              <option value="" disabled selected>Sélectionnez une ville</option>
              <option *ngFor="let v of villes" [value]="v">{{ v }}</option>
            </select>
            <div *ngIf="expertForm.get('ville')?.invalid && expertForm.get('ville')?.touched" class="text-red-500 text-xs mt-1">
              La ville est requise.
            </div>
          </div>

          <!-- Code postal -->
          <div>
            <label for="codePostal" class="block mb-2 text-sm font-medium text-gray-700">Code postal <span class="text-red-500">*</span></label>
            <input
              id="codePostal"
              type="text"
              formControlName="codePostal"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
              readonly
            >
            <div *ngIf="expertForm.get('codePostal')?.invalid && expertForm.get('codePostal')?.touched" class="text-red-500 text-xs mt-1">
              Le code postal est requis.
            </div>
          </div>
        </div>
      </div>

      <!-- Informations professionnelles -->
      <div class="mb-6">
        <h2 class="text-lg font-medium text-teal-800 mb-4 pb-2 border-b border-gray-200">Informations professionnelles</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Date de début de travail -->
          <div>
            <label for="dateDebutTravail" class="block mb-2 text-sm font-medium text-gray-700">Date d'inscription <span class="text-red-500">*</span></label>
            <input
              id="dateDebutTravail"
              type="date"
              formControlName="dateDebutTravail"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
            >
            <div *ngIf="expertForm.get('dateDebutTravail')?.invalid && expertForm.get('dateDebutTravail')?.touched" class="text-red-500 text-xs mt-1">
              <div *ngIf="expertForm.get('dateDebutTravail')?.errors?.['required']">
                La date d'inscription est requise.
              </div>
              <div *ngIf="expertForm.get('dateDebutTravail')?.errors?.['invalidDateDebutTravail']">
                La date de début de travail doit être entre 1985 et aujourd'hui.
              </div>
            </div>
          </div>
            <div>
            <label for="specialite" class="block mb-2 text-sm font-medium text-gray-700">Spécialité <span class="text-red-500">*</span></label>
            <select
              id="specialite"
              formControlName="specialite"
              class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600"
            >
              <option value="" disabled selected>Sélectionnez une spécialité</option>
              <option value="vehicule_lourd_et_leger">Véhicule lourd et léger</option>
              <option value="mecanique_generale">Mécanique générale</option>
              <option value="incendie">Incendie</option>
              <option value="batiment">Bâtiment</option>
              <option value="genie_civil">Génie civil</option>
              <option value="informatique_et_machine_electronique">Informatique et machine électronique</option>
              <option value="commissaire_davarie">Commissaire d'avarie</option>
              <option value="medical">Médical</option>
              <option value="evaluation_degats_corpels">Évaluation de dégâts corporels d'accident de circulation</option>
              <option value="perte_exploitation_incendie">Perte d'exploitation après incendie</option>
              <option value="electricite">Électricité</option>
              <option value="alimentation_et_industrie_alimentaire">Alimentation et industrie alimentaire</option>
              <option value="finances">Finances</option>
              <option value="electrique_navires">Électrique de navires</option>
              <option value="corps_navire_maritime">Corps de navire maritime</option>
              <option value="autre">Autre</option>
            </select>
            <div *ngIf="expertForm.get('specialite')?.invalid && expertForm.get('specialite')?.touched" class="text-red-500 text-xs mt-1">
              La spécialité est requise.
            </div>
          </div>
        </div>
      </div>

      <!-- Identifiants de connexion -->
      <div class="mb-6">
        <h2 class="text-lg font-medium text-teal-800 mb-4 pb-2 border-b border-gray-200">Identifiants de connexion</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Mot de passe -->
          <div>
            <label for="password" class="block mb-2 text-sm font-medium text-gray-700">Mot de passe <span class="text-red-500">*</span></label>
            <div class="relative">
              <input
                id="password"
                [type]="showPassword ? 'text' : 'password'"
                formControlName="password"
                class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600 pr-10"
                placeholder="••••••••"
              >
              <button
                type="button"
                class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 hover:text-teal-800"
                (click)="showPassword = !showPassword"
              >
                <i class="fas" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
              </button>
            </div>
            <div *ngIf="expertForm.get('password')?.invalid && expertForm.get('password')?.touched" class="text-red-500 text-xs mt-1">
              <div *ngIf="expertForm.get('password')?.errors?.['required']">Le mot de passe est requis.</div>
              <div *ngIf="expertForm.get('password')?.errors?.['minlength']">Le mot de passe doit contenir au moins 8 caractères.</div>
              <div *ngIf="expertForm.get('password')?.errors?.['pattern']">
                Le mot de passe doit contenir au moins une majuscule, une minuscule, un chiffre et un caractère spécial.
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule, un chiffre et un caractère spécial.</p>
          </div>

          <!-- Confirmation de mot de passe -->
          <div>
            <label for="confirmPassword" class="block mb-2 text-sm font-medium text-gray-700">Confirmer le mot de passe <span class="text-red-500">*</span></label>
            <div class="relative">
              <input
                id="confirmPassword"
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-teal-800 focus:border-teal-800 block w-full p-2.5 transition-all hover:border-teal-600 pr-10"
                placeholder="••••••••"
              >
              <button
                type="button"
                class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 hover:text-teal-800"
                (click)="showConfirmPassword = !showConfirmPassword"
              >
                <i class="fas" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
              </button>
            </div>
            <div *ngIf="expertForm.get('confirmPassword')?.invalid && expertForm.get('confirmPassword')?.touched" class="text-red-500 text-xs mt-1">
              <div *ngIf="expertForm.get('confirmPassword')?.errors?.['required']">La confirmation du mot de passe est requise.</div>
              <div *ngIf="expertForm.get('confirmPassword')?.errors?.['passwordMismatch']">Les mots de passe ne correspondent pas.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Boutons de soumission -->
      <div class="flex justify-end gap-4 mt-8">
        <button
          type="button"
          class="py-2.5 px-6 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-colors"
        >
          Annuler
        </button>
        <button
          type="submit"
          [disabled]="expertForm.invalid || emailExists || cinExists"
          class="py-2.5 px-6 bg-teal-800 text-white rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-800 disabled:opacity-60 disabled:cursor-not-allowed transition-colors"
        >
          <i class="fas fa-user-plus mr-2"></i>
          Ajouter l'expert
        </button>
      </div>
    </form>
  </div>
</div>
