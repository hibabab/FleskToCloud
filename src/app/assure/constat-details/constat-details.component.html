<!-- constat-details.component.html -->
<div class="fixed inset-0 bg-gray-500/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
    <!-- Header -->
    <div class="px-6 py-4 bg-teal-700 text-white flex justify-between items-center">
      <h2 class="text-xl font-bold">Détails du constat</h2>
      <button (click)="closeDialog()" class="rounded-full p-2 hover:bg-teal-600 transition-colors">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-16">
      <div class="w-12 h-12 border-4 border-t-teal-500 border-r-teal-500 border-b-transparent border-l-transparent rounded-full animate-spin"></div>
      <p class="mt-4 text-gray-600">Chargement des détails...</p>
    </div>

    <!-- Content when loaded -->
    <div *ngIf="!loading && constatDetails" class="p-6">
      <div class="bg-teal-50 p-4 rounded-lg mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <p class="text-xs text-teal-700 font-semibold mb-1">Immatriculation</p>
            <p class="font-mono text-lg">{{ constatDetails.vehicule?.Imat || 'N/A' }}</p>
          </div>
          <div>
            <p class="text-xs text-teal-700 font-semibold mb-1">Date de l'accident</p>
            <p>{{ constatDetails.dateAccident | date:'dd/MM/yyyy' }} à {{ constatDetails.heure }}</p>
          </div>
          <div>
            <p class="text-xs text-teal-700 font-semibold mb-1">Statut</p>
            <p class="inline-flex items-center">
              <span [ngClass]="constatDetails.statutClass" 
                    class="px-3 py-1 rounded-full text-xs font-semibold">
                <i class="mr-2" [ngClass]="constatDetails.statutIcon"></i>
                {{ constatDetails.statut }}
              </span>
            </p>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="border-b border-gray-200 mb-6">
        <nav class="flex -mb-px">
          <button (click)="setActiveTab('conducteur')" 
                  class="px-4 py-2 font-medium text-sm border-b-2 transition-colors"
                  [ngClass]="activeTab === 'conducteur' ? 'border-teal-500 text-teal-600' : 'border-transparent text-gray-500 hover:text-gray-700'">
            <i class="fas fa-user mr-2"></i>
            Conducteur
          </button>
          <button (click)="setActiveTab('temoins')" 
                  class="px-4 py-2 font-medium text-sm border-b-2 transition-colors"
                  [ngClass]="activeTab === 'temoins' ? 'border-teal-500 text-teal-600' : 'border-transparent text-gray-500 hover:text-gray-700'">
            <i class="fas fa-users mr-2"></i>
            Témoins ({{ constatDetails.temoins?.length || 0 }})
          </button>
          <button (click)="setActiveTab('circonstances')" 
                  class="px-4 py-2 font-medium text-sm border-b-2 transition-colors"
                  [ngClass]="activeTab === 'circonstances' ? 'border-teal-500 text-teal-600' : 'border-transparent text-gray-500 hover:text-gray-700'">
            <i class="fas fa-car-crash mr-2"></i>
            Circonstances
          </button>
          <button (click)="setActiveTab('photos')" 
                  class="px-4 py-2 font-medium text-sm border-b-2 transition-colors"
                  [ngClass]="activeTab === 'photos' ? 'border-teal-500 text-teal-600' : 'border-transparent text-gray-500 hover:text-gray-700'">
            <i class="fas fa-images mr-2"></i>
            Photos justificatives ({{ constatDetails.photos?.length || 0 }})
          </button>
        </nav>
      </div>

      <!-- Tab content -->
      <div [ngSwitch]="activeTab" class="px-2">
        <!-- Conducteur -->
        <div *ngSwitchCase="'conducteur'" class="space-y-6">
          <div *ngIf="constatDetails.conducteur" class="bg-white rounded-lg border border-gray-200 p-5">
            <div class="flex items-center mb-4">
              <div class="w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center">
                <i class="fas fa-user text-teal-500"></i>
              </div>
              <h3 class="ml-3 text-lg font-medium">{{ constatDetails.conducteur.nom }} {{ constatDetails.conducteur.prenom }}</h3>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-xs text-gray-500 mb-1">Permis de conduire</p>
                <p class="font-mono">{{ constatDetails.conducteur.numPermis }}</p>
              </div>
              <div *ngIf="constatDetails.conducteur.adresse">
                <p class="text-xs text-gray-500 mb-1">Adresse</p>
                <p>
                  {{ constatDetails.conducteur.adresse.rue }}
                  <br>
                  {{ constatDetails.conducteur.adresse.codePostal }} {{ constatDetails.conducteur.adresse.ville }}
                </p>
              </div>
            </div>
          </div>
          
          <div *ngIf="!constatDetails.conducteur" class="text-center py-8">
            <i class="fas fa-user-slash text-gray-300 text-4xl mb-3"></i>
            <p class="text-gray-500">Aucune information sur le conducteur n'est disponible.</p>
          </div>
        </div>

        <!-- Témoins -->
        <div *ngSwitchCase="'temoins'">
          <div *ngIf="constatDetails.temoins && constatDetails.temoins.length > 0" class="space-y-4">
            <div *ngFor="let temoin of constatDetails.temoins" class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center mb-3">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                  <i class="fas fa-user text-blue-500"></i>
                </div>
                <h4 class="ml-3 font-medium">{{ temoin.nom }} {{ temoin.prenom }}</h4>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                  <p class="text-xs text-gray-500 mb-1">Téléphone</p>
                  <p>{{ temoin.telephone }}</p>
                </div>
                <div *ngIf="temoin.adresse">
                  <p class="text-xs text-gray-500 mb-1">Adresse</p>
                  <p>
                    {{ temoin.adresse.rue }}
                    <br>
                    {{ temoin.adresse.codePostal }} {{ temoin.adresse.ville }}
                  </p>
                </div>
              </div>
            </div>
          </div>
          
          <div *ngIf="!constatDetails.temoins || constatDetails.temoins.length === 0" class="text-center py-8">
            <i class="fas fa-users text-gray-300 text-4xl mb-3"></i>
            <p class="text-gray-500">Aucun témoin n'est enregistré pour ce constat.</p>
          </div>
        </div>

        <!-- Circonstances -->
        <div *ngSwitchCase="'circonstances'" class="space-y-6">
          <div class="bg-white rounded-lg border border-gray-200 p-5">
            <div class="flex items-center mb-4">
              <div class="w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center">
                <i class="fas fa-car-crash text-teal-500"></i>
              </div>
              <h3 class="ml-3 text-lg font-medium">Circonstances de l'accident</h3>
            </div>

            <div class="bg-teal-50 p-4 rounded-lg">
              <div class="whitespace-pre-wrap text-sm">
                {{ constatDetails.circonstance || 'Aucune circonstance renseignée' }}
              </div>
            </div>
          </div>
        </div>

        <!-- Photos -->
        <div *ngSwitchCase="'photos'">
          <div *ngIf="constatDetails.photos && constatDetails.photos.length > 0" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div *ngFor="let photo of constatDetails.photos" class="rounded-lg overflow-hidden shadow-md border border-gray-200">
              <img [src]="'http://localhost:3000' + photo.url" class="w-full h-48 object-cover" alt="Photo justificative">
              <div class="p-3 bg-white">
                <p class="text-xs text-gray-500">Photo justificative</p>
              </div>
            </div>
          </div>
          
          <div *ngIf="!constatDetails.photos || constatDetails.photos.length === 0" class="text-center py-8">
            <i class="fas fa-images text-gray-300 text-4xl mb-3"></i>
            <p class="text-gray-500">Aucune photo justificative n'est disponible.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 bg-gray-50 flex justify-end">
      <button (click)="closeDialog()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors">
        Fermer
      </button>
    </div>
  </div>
</div>