<!-- constat-list.component.html -->
<div class="flex bg-gray-50 min-h-screen">
  <app-dashboard></app-dashboard>
  <div class="flex-1 mt-20 ml-60 p-6">
    <section>
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-3xl font-bold text-teal-700">Gestion des sinistres</h2>
          <p class="text-sm text-slate-700 mt-2">Suivi en temps réel de vos déclarations de sinistres</p>
        </div>

        <div class="relative">
          <button (click)="toggleFilters()" 
                  class="bg-teal-700 text-white px-4 py-2.5 rounded-lg hover:bg-teal-800 transition-all 
                         flex items-center shadow-md hover:shadow-indigo-100">
            <i class="fas fa-sliders-h mr-3 transform rotate-90"></i>
            Filtrer les constats
          </button>
          <div *ngIf="showFilters" 
               class="absolute right-0 mt-3 w-56 bg-white rounded-xl shadow-2xl py-3 z-10 border border-slate-100">
            <a *ngFor="let status of statusFilters" 
               class="block px-5 py-2.5 text-slate-700 hover:bg-indigo-50 cursor-pointer transition-colors
                      text-sm font-medium"
               (click)="filterByStatus(status.key); toggleFilters()">
              <i class="fas fa-circle mr-2 text-[0.6rem] opacity-70" 
                 [ngClass]="{
                   'text-teal-800-400': status.key === selectedStatus,
                   'text-teal-800': status.key !== selectedStatus
                 }"></i>
              {{ status.label }}
            </a>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full table-auto text-sm text-left">
            <thead class="bg-gray-200 text-teal-900 uppercase text-xs font-semibold">
              <tr>
                <th class="px-6 py-3">Immatriculation</th>
                <th class="px-6 py-3">Date/Heure</th>
                <th class="px-6 py-3">Lieu</th>
                <th class="px-6 py-3">Statut</th>
                <th class="px-6 py-3">Documents</th>
                <th class="px-6 py-3">Expert</th>
                <th class="px-6 py-3 text-center">Actions</th>
              </tr>
            </thead>

            <tbody class="divide-y divide-gray-200">
              <tr *ngFor="let constat of filteredConstats" class="hover:bg-gray-50 transition-colors">
                <td class="px-6 py-4 font-mono text-teal-700">
                  {{ constat.vehicule?.Imat || 'N/A' }}
                </td>
                <td class="px-6 py-4">
                  <div class="flex flex-col">
                    <span class="text-gray-700">{{ constat.dateAccident | date:'dd/MM/yyyy' }}</span>
                    <span class="text-gray-500 text-sm">{{ constat.heure }}</span>
                  </div>
                </td>
                <td class="px-6 py-4 text-gray-600 max-w-xs">
                  <span *ngIf="constat.lieu">
                    {{ constat.lieu.rue }},
                    {{ constat.lieu.codePostal }} {{ constat.lieu.ville }}
                  </span>
                  <span *ngIf="!constat.lieu" class="text-gray-400 italic">Non spécifié</span>
                </td>
                <td class="px-6 py-4">
                  <div class="inline-flex items-center">
                    <span [ngClass]="statusClasses[constat.statut]" 
                          class="px-3 py-1 rounded-full text-xs font-semibold">
                      <i class="mr-2" [ngClass]="statusIcons[constat.statut]"></i>
                      {{ constat.statut }}
                    </span>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <div class="flex space-x-3">
                    <a *ngIf="constat.pathurl" 
                       [href]="'http://localhost:3000' + constat.pathurl"
                       class="text-teal-600 hover:text-teal-800 transition"
                       target="_blank"
                       title="Télécharger le constat">
                      <i class="fas fa-file-pdf text-lg"></i>
                    </a>
                    <a *ngIf="constat.rapport?.pathurl"
                       class="text-gray-600 hover:text-gray-800 transition"
                       target="_blank"
                       title="Voir le rapport">
                      <i class="fas fa-file-alt text-lg"></i>
                    </a>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <div *ngIf="constat.expert" class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center mr-2">
                      <i class="fas fa-user-tie text-teal-600 text-sm"></i>
                    </div>
                    <div>
                      <p class="text-gray-800">{{ constat.expert.user.nom }} {{ constat.expert.user.prenom }}</p>
                      <p class="text-xs text-gray-500">{{ constat.expert.specialite }}</p>
                    </div>
                  </div>
                  <span *ngIf="!constat.expert" class="text-gray-400 italic">En attente</span>
                </td>
                <td class="px-6 py-4 text-center">
                  <button (click)="viewDetails(constat.idConstat)" 
                          class="bg-indigo-50 hover:bg-indigo-100 text-indigo-700 px-4 py-1.5 rounded-lg transition-colors
                                 inline-flex items-center text-xs font-medium">
                    <i class="fas fa-eye mr-2"></i>
                    Voir détails
                  </button>
                </td>
              </tr>

              <tr *ngIf="filteredConstats.length === 0">
                <td colspan="7" class="text-center px-6 py-8">
                  <div class="flex flex-col items-center justify-center space-y-3 text-slate-400/80">
                    <i class="fas fa-clipboard-list text-4xl"></i>
                    <p class="text-lg font-medium">Aucun constat trouvé</p>
                    <p class="text-sm max-w-[300px]">Aucun résultat ne correspond à vos critères de filtrage</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Composant de détails (modal) -->
<app-constat-details 
  *ngIf="showDetails" 
  [constatId]="selectedConstatId!" 
  (close)="hideConstatDetails()">
</app-constat-details>